<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prompt Coach ‚Äî Bonnes pratiques (ChatGPT)</title>

  <style>
    :root{
      --bg:#0b1020; --panel:#121a33; --panel2:#0f1630; --text:#eaf0ff; --muted:#b9c3e6;
      --accent:#7aa2ff; --good:#4ade80; --warn:#fbbf24; --bad:#fb7185; --border:rgba(255,255,255,.12);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    /* =========================
       LEOV BRANDING (V2)
    ========================= */
    :root{
      /* Tu peux ajuster ici si besoin */
      --leov-primary:#4F46E5;
      --leov-secondary:#0F172A;
      --leov-accent:#22C55E;

      /* override accent existant */
      --accent:var(--leov-primary);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background:
        radial-gradient(1200px 600px at 30% -10%, rgba(122,162,255,.25), transparent 60%),
        radial-gradient(900px 500px at 90% 0%, rgba(74,222,128,.18), transparent 55%),
        var(--bg);
      color:var(--text);
      font-family:var(--sans);
      line-height:1.35;
    }
    a{color:var(--accent); text-decoration:none}
    .wrap{max-width:1200px;margin:0 auto;padding:28px 18px 80px}
    header{display:flex;gap:16px;align-items:flex-start;justify-content:space-between;flex-wrap:wrap}
    .title{display:flex;flex-direction:column;gap:6px}
    h1{margin:0;font-size:22px;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:13px;max-width:760px}
    .chiprow{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .chip{border:1px solid var(--border);background:rgba(255,255,255,.05);padding:7px 10px;border-radius:999px;font-size:12px;color:var(--muted)}
    .grid{display:grid;grid-template-columns:1.05fr .95fr;gap:14px;margin-top:16px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden
    }
    .card h2{margin:0;font-size:14px;letter-spacing:.3px;text-transform:uppercase;color:rgba(234,240,255,.88)}
    .card .hd{padding:14px 14px 10px;border-bottom:1px solid rgba(255,255,255,.08);display:flex;align-items:center;justify-content:space-between;gap:12px}
    .card .bd{padding:14px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .btn{
      appearance:none;border:1px solid var(--border);
      background:rgba(255,255,255,.05);
      color:var(--text);
      padding:9px 11px;border-radius:12px;cursor:pointer;font-size:13px
    }
    .btn:hover{background:rgba(255,255,255,.08)}
    .btn.primary{border-color:rgba(122,162,255,.6);background:rgba(122,162,255,.15)}
    .btn.good{border-color:rgba(74,222,128,.6);background:rgba(74,222,128,.12)}
    .btn:active{transform:translateY(1px)}
    .pill{padding:6px 10px;border-radius:999px;border:1px solid var(--border);font-size:12px;color:var(--muted)}
    .kpi{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    @media (max-width:720px){.kpi{grid-template-columns:repeat(2,1fr)}}
    .kpi .box{border:1px solid rgba(255,255,255,.09);background:rgba(0,0,0,.12);border-radius:14px;padding:10px}
    .kpi .lab{font-size:12px;color:var(--muted);margin-bottom:6px}
    .kpi .val{font-size:18px;font-weight:700}
    .bar{height:10px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden;border:1px solid rgba(255,255,255,.09)}
    .bar > div{height:100%;width:0%;background:linear-gradient(90deg,var(--bad),var(--warn),var(--good))}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    input[type="text"], textarea, select{
      width:100%;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.18);
      color:var(--text);
      border-radius:14px;
      padding:10px 11px;
      outline:none;
      font-size:13px
    }
    textarea{min-height:88px;resize:vertical}
    .two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:720px){.two{grid-template-columns:1fr}}
    .checklist{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
    @media (max-width:900px){.checklist{grid-template-columns:1fr}}
    .item{border:1px solid rgba(255,255,255,.09);background:rgba(0,0,0,.12);border-radius:14px;padding:10px;display:flex;gap:10px;align-items:flex-start}
    .item input{margin-top:2px}
    .item .t{font-weight:650;font-size:13px}
    .item .d{font-size:12px;color:var(--muted);margin-top:2px}
    .hint{font-size:12px;color:var(--muted);margin-top:8px}
    .mono{font-family:var(--mono)}
    .out{
      white-space:pre-wrap;
      word-break:break-word;
      border:1px dashed rgba(255,255,255,.18);
      background:rgba(0,0,0,.2);
      border-radius:14px;
      padding:12px;
      font-size:12.5px;
    }
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{padding:8px 10px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.14);cursor:pointer;font-size:13px;color:var(--muted)}
    .tab.active{border-color:rgba(122,162,255,.65);background:rgba(122,162,255,.16);color:var(--text)}
    .examples{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:900px){.examples{grid-template-columns:1fr}}
    .badge{font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.12);color:var(--muted)}
    .footer{margin-top:16px;color:rgba(185,195,230,.85);font-size:12px}
    .small{font-size:12px;color:var(--muted)}

    /* ========== LEOV HEADER (V2) ========== */
    .leov-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding:14px 18px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background:linear-gradient(
        180deg,
        rgba(79,70,229,.18),
        rgba(15,23,42,.96)
      );
      position:sticky;
      top:0;
      z-index:10;
      backdrop-filter:saturate(120%) blur(8px);
    }
    .leov-brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:240px;
    }
    .leov-logo{
      height:28px;
      display:block;
    }
    .leov-brand a{display:flex;align-items:center;gap:12px}
    .leov-title{font-weight:700;font-size:15px}
    .leov-tagline{font-size:12px;color:var(--muted)}

    .leov-actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .leov-actions a{
      font-size:13px;
      opacity:.88;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.10);
    }
    .leov-actions a:hover{
      opacity:1;
      background:rgba(255,255,255,.06);
    }
    .langbtn{
      appearance:none;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.10);
      color:var(--text);
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
      font-size:13px;
      opacity:.92;
    }
    .langbtn:hover{opacity:1;background:rgba(255,255,255,.06)}
  </style>
</head>

<body>

  <!-- LEOV HEADER -->
  <div class="leov-header">
    <div class="leov-brand">
      <!-- Logo cliquable -->
      <a href="https://www.leov.co" target="_blank" rel="noopener noreferrer" title="Go to leov.co">
        <img src="leov-logo.png" class="leov-logo" alt="LEOV" />
        <div>
          <div class="leov-title">
            <span id="hdr_appname">Prompt Coach</span> <span style="opacity:.7">by LEOV</span>
          </div>
          <div class="leov-tagline" id="hdr_tagline">Write clearer prompts. Get better results.</div>
        </div>
      </a>
    </div>

    <div class="leov-actions">
      <a href="https://www.leov.co" target="_blank" rel="noopener noreferrer" id="hdr_site">Site LEOV</a>
      <button class="langbtn" id="btnLang">FR / EN</button>
    </div>
  </div>

  <div class="wrap">
    <header>
      <div class="title">
        <h1 id="mainTitle">Prompt Coach ‚Äî App interactive (bonnes pratiques de prompts pour ChatGPT)</h1>
        <div class="sub" id="mainSub">
          Objectif : t‚Äôaider √† passer d‚Äôun prompt ‚Äúflou‚Äù √† un prompt <b>clair</b>, <b>contextualis√©</b>, <b>contraint</b> et <b>testable</b>.
          Remplis les champs ‚Üí observe le score ‚Üí applique les am√©liorations ‚Üí copie le prompt final.
        </div>
        <div class="chiprow">
          <span class="chip" id="chip1">‚úÖ Contexte &amp; intention</span>
          <span class="chip" id="chip2">‚úÖ Contraintes (format, ton, longueur)</span>
          <span class="chip" id="chip3">‚úÖ Donn√©es / exemples</span>
          <span class="chip" id="chip4">‚úÖ Crit√®res de succ√®s</span>
          <span class="chip" id="chip5">‚úÖ It√©ration (questions manquantes)</span>
        </div>
      </div>

      <div class="row">
        <button class="btn primary" id="btnLoadDemo">Charger un exemple</button>
        <button class="btn" id="btnReset">R√©initialiser</button>
        <button class="btn good" id="btnCopy">Copier le prompt final</button>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: Builder -->
      <section class="card">
        <div class="hd">
          <h2 id="h2_builder">1) Constructeur de prompt</h2>
          <span class="pill" id="modePill">Mode : G√©n√©ral</span>
        </div>
        <div class="bd">
          <div class="two">
            <div>
              <label id="lbl_goal">Objectif (une phrase)</label>
              <input type="text" id="goal" placeholder="Ex: R√©diger un email de relance professionnel‚Ä¶" />
              <div class="hint" id="hint_goal">Astuce : commence par un verbe d‚Äôaction (r√©diger, analyser, comparer, r√©sumer, proposer‚Ä¶).</div>
            </div>
            <div>
              <label id="lbl_role">R√¥le / posture demand√©e</label>
              <input type="text" id="role" placeholder="Ex: Agis comme un recruteur senior / un tuteur / un coach‚Ä¶" />
              <div class="hint" id="hint_role">Astuce : un r√¥le utile = comp√©tence + angle (ex: ‚Äúcoach carri√®re orient√© march√© qu√©b√©cois‚Äù).</div>
            </div>
          </div>

          <div style="height:10px"></div>

          <div class="two">
            <div>
              <label id="lbl_context">Contexte (qui / quoi / pourquoi)</label>
              <textarea id="context" placeholder="Ex: Je postule √† un poste de‚Ä¶ J‚Äôai ce parcours‚Ä¶ Le but est de‚Ä¶"></textarea>
            </div>
            <div>
              <label id="lbl_inputs">Entr√©es (donn√©es, texte, liste, contraintes m√©tier)</label>
              <textarea id="inputs" placeholder="Colle ici le texte √† retravailler, un brief, des points cl√©s, un tableau, etc."></textarea>
              <div class="hint" id="hint_inputs">Astuce : plus tu fournis d‚Äôinputs concrets, moins le mod√®le ‚Äúinvente‚Äù.</div>
            </div>
          </div>

          <div style="height:10px"></div>

          <div class="two">
            <div>
              <label id="lbl_format">Format de sortie</label>
              <select id="format">
                <option value="auto" id="opt_auto">Auto (√† partir des contraintes)</option>
                <option value="bullets" id="opt_bullets">Bullet points</option>
                <option value="table" id="opt_table">Tableau</option>
                <option value="email" id="opt_email">Email</option>
                <option value="plan" id="opt_plan">Plan d√©taill√©</option>
                <option value="code" id="opt_code">Code (avec instructions)</option>
                <option value="json" id="opt_json">JSON (sch√©ma simple)</option>
              </select>
              <div class="hint" id="hint_format">Astuce : ‚Äúdonne-moi un tableau‚Äù = colonne/ordre/format des dates/unit√©s.</div>
            </div>

            <div>
              <label id="lbl_tone">Tonalit√©</label>
              <select id="tone">
                <option value="neutre" id="tone_neutre">Neutre</option>
                <option value="pro" id="tone_pro">Professionnel</option>
                <option value="direct" id="tone_direct">Direct &amp; concis</option>
                <option value="pedago" id="tone_pedago">P√©dagogique</option>
                <option value="creatif" id="tone_creatif">Cr√©atif</option>
                <option value="humble" id="tone_humble">Empathique &amp; humble</option>
              </select>
            </div>
          </div>

          <div style="height:10px"></div>

          <div class="two">
            <div>
              <label id="lbl_constraints">Contraintes (longueur, langue, interdits, style‚Ä¶)</label>
              <textarea id="constraints" placeholder="Ex: 180‚Äì220 mots, fran√ßais, pas de jargon, 3 options, pas de flatterie excessive‚Ä¶"></textarea>
            </div>
            <div>
              <label id="lbl_success">Crit√®res de succ√®s (comment juger que c‚Äôest bon ?)</label>
              <textarea id="success" placeholder="Ex: doit √™tre actionnable, clair, pas d‚Äôhypoth√®ses, inclure 3 √©tapes et un CTA‚Ä¶"></textarea>
              <div class="hint" id="hint_success">Astuce : ajoute ‚Äúsi info manquante ‚Üí pose 3 questions max‚Äù.</div>
            </div>
          </div>

          <div style="height:10px"></div>

          <div class="two">
            <div>
              <label id="lbl_audience">Audience cible</label>
              <input type="text" id="audience" placeholder="Ex: un directeur RH, un client, des enfants de 6‚Äì10 ans‚Ä¶" />
            </div>
            <div>
              <label id="lbl_examples">Exemple (optionnel) : ‚Äúce que j‚Äôaime / n‚Äôaime pas‚Äù</label>
              <textarea id="examples" placeholder="Ex: j‚Äôaime des phrases courtes, un ton factuel; je n‚Äôaime pas les g√©n√©ralit√©s‚Ä¶"></textarea>
            </div>
          </div>

          <div style="height:10px"></div>

          <div class="checklist" id="checklist"></div>

          <div class="row" style="margin-top:12px;justify-content:space-between">
            <div class="small" id="realtimeMsg">üîÅ Tout est recalcul√© en temps r√©el (score + recommandations).</div>
            <div class="row">
              <button class="btn" id="btnAsk3">Ajouter ‚Äúpose 3 questions si manque‚Äù</button>
              <button class="btn" id="btnAddSteps">Ajouter ‚Äúr√©ponds en √©tapes‚Äù</button>
            </div>
          </div>
        </div>
      </section>

      <!-- RIGHT: Score + Output -->
      <aside class="card">
        <div class="hd">
          <h2 id="h2_diag">2) Diagnostic &amp; prompt final</h2>
          <div class="tabs">
            <div class="tab active" data-tab="score" id="tabScore">Score</div>
            <div class="tab" data-tab="suggest" id="tabSuggest">Suggestions</div>
            <div class="tab" data-tab="examples" id="tabExamples">Avant / Apr√®s</div>
          </div>
        </div>

        <div class="bd" id="tab-score">
          <div class="kpi">
            <div class="box">
              <div class="lab" id="labScore">Score prompt</div>
              <div class="val" id="scoreVal">0/100</div>
            </div>
            <div class="box">
              <div class="lab" id="labClarity">Clart√©</div>
              <div class="val" id="kpiClarity">0</div>
            </div>
            <div class="box">
              <div class="lab" id="labConstraints">Contraintes</div>
              <div class="val" id="kpiConstraints">0</div>
            </div>
            <div class="box">
              <div class="lab" id="labData">Donn√©es</div>
              <div class="val" id="kpiData">0</div>
            </div>
          </div>

          <div style="height:10px"></div>
          <div class="bar"><div id="scoreBar" style="width: 0%;"></div></div>
          <div class="hint" id="scoreMsg">Faible : prompt trop vague. Commence par objectif + contexte + format + contraintes.</div>

          <div style="height:12px"></div>
          <label id="lbl_final">Prompt final (copiable)</label>
          <div class="out mono" id="finalPrompt"></div>

          <div class="row" style="margin-top:10px;justify-content:space-between">
            <button class="btn" id="btnExportTxt">Exporter .txt</button>
            <button class="btn" id="btnExportJson">Exporter .json</button>
          </div>

          <div class="footer" id="footerMsg">
            Rappel : un bon prompt = <b>intention</b> + <b>contexte</b> + <b>inputs</b> + <b>contraintes</b> + <b>format</b> + <b>crit√®res</b>.
          </div>
        </div>

        <div class="bd" id="tab-suggest" style="display:none">
          <label id="lbl_recos">Recommandations concr√®tes (prioris√©es)</label>
          <div id="suggestions"></div>

          <div style="height:10px"></div>
          <label id="lbl_anti">‚ÄúAnti-patterns‚Äù fr√©quents</label>
          <div class="out" id="antipatterns"></div>
        </div>

        <div class="bd" id="tab-examples" style="display:none">
          <div class="examples">
            <div>
              <div class="row" style="justify-content:space-between;margin-bottom:6px">
                <label id="lbl_before">Prompt ‚Äúavant‚Äù (trop vague)</label>
                <span class="badge" id="badge_before">Flou / Non testable</span>
              </div>
              <div class="out mono" id="beforeEx"></div>
            </div>
            <div>
              <div class="row" style="justify-content:space-between;margin-bottom:6px">
                <label id="lbl_after">Prompt ‚Äúapr√®s‚Äù (am√©lior√©)</label>
                <span class="badge" id="badge_after">Contraint / Actionnable</span>
              </div>
              <div class="out mono" id="afterEx"></div>
            </div>
          </div>

          <div style="height:10px"></div>
          <label id="lbl_templates">Templates rapides</label>
          <div class="row" style="gap:8px;flex-wrap:wrap">
            <button class="btn" data-template="rewrite" id="tpl_rewrite">R√©√©criture</button>
            <button class="btn" data-template="analysis" id="tpl_analysis">Analyse</button>
            <button class="btn" data-template="plan" id="tpl_plan">Plan</button>
            <button class="btn" data-template="code" id="tpl_code">Code</button>
            <button class="btn" data-template="brainstorm" id="tpl_brainstorm">Brainstorm</button>
          </div>
          <div class="hint" id="tpl_hint">Clique un template ‚Üí il pr√©-remplit le builder avec une structure de prompt.</div>
        </div>
      </aside>
    </div>
  </div>

<script>
(() => {
  // ---------- Helpers ----------
  const $ = (id) => document.getElementById(id);
  const sanitize = (s) => (s || "").toString().trim();
  const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
  const nowISO = () => new Date().toISOString();

  // ---------- i18n ----------
  let lang = "fr"; // "fr" or "en"

  const I18N = {
    fr: {
      docTitle: "Prompt Coach ‚Äî Bonnes pratiques (ChatGPT)",
      hdrTagline: "Write clearer prompts. Get better results.",
      hdrSite: "Site LEOV",
      mainTitle: "Prompt Coach ‚Äî App interactive (bonnes pratiques de prompts pour ChatGPT)",
      mainSub: `Objectif : t‚Äôaider √† passer d‚Äôun prompt ‚Äúflou‚Äù √† un prompt <b>clair</b>, <b>contextualis√©</b>, <b>contraint</b> et <b>testable</b>.
               Remplis les champs ‚Üí observe le score ‚Üí applique les am√©liorations ‚Üí copie le prompt final.`,
      chips: [
        "‚úÖ Contexte & intention",
        "‚úÖ Contraintes (format, ton, longueur)",
        "‚úÖ Donn√©es / exemples",
        "‚úÖ Crit√®res de succ√®s",
        "‚úÖ It√©ration (questions manquantes)"
      ],
      btnLoadDemo: "Charger un exemple",
      btnReset: "R√©initialiser",
      btnCopy: "Copier le prompt final",
      builderTitle: "1) Constructeur de prompt",
      diagTitle: "2) Diagnostic & prompt final",
      labels: {
        goal: "Objectif (une phrase)",
        role: "R√¥le / posture demand√©e",
        context: "Contexte (qui / quoi / pourquoi)",
        inputs: "Entr√©es (donn√©es, texte, liste, contraintes m√©tier)",
        format: "Format de sortie",
        tone: "Tonalit√©",
        constraints: "Contraintes (longueur, langue, interdits, style‚Ä¶)",
        success: "Crit√®res de succ√®s (comment juger que c‚Äôest bon ?)",
        audience: "Audience cible",
        examples: "Exemple (optionnel) : ‚Äúce que j‚Äôaime / n‚Äôaime pas‚Äù",
        final: "Prompt final (copiable)",
        recos: "Recommandations concr√®tes (prioris√©es)",
        anti: "‚ÄúAnti-patterns‚Äù fr√©quents",
        before: "Prompt ‚Äúavant‚Äù (trop vague)",
        after: "Prompt ‚Äúapr√®s‚Äù (am√©lior√©)",
        templates: "Templates rapides",
      },
      hints: {
        goal: "Astuce : commence par un verbe d‚Äôaction (r√©diger, analyser, comparer, r√©sumer, proposer‚Ä¶).",
        role: "Astuce : un r√¥le utile = comp√©tence + angle (ex: ‚Äúcoach carri√®re orient√© march√© qu√©b√©cois‚Äù).",
        inputs: "Astuce : plus tu fournis d‚Äôinputs concrets, moins le mod√®le ‚Äúinvente‚Äù.",
        format: "Astuce : ‚Äúdonne-moi un tableau‚Äù = colonne/ordre/format des dates/unit√©s.",
        success: "Astuce : ajoute ‚Äúsi info manquante ‚Üí pose 3 questions max‚Äù.",
        templates: "Clique un template ‚Üí il pr√©-remplit le builder avec une structure de prompt."
      },
      realtimeMsg: "üîÅ Tout est recalcul√© en temps r√©el (score + recommandations).",
      btnAsk3: "Ajouter ‚Äúpose 3 questions si manque‚Äù",
      btnAddSteps: "Ajouter ‚Äúr√©ponds en √©tapes‚Äù",
      tabs: { score:"Score", suggest:"Suggestions", examples:"Avant / Apr√®s" },
      kpi: { score:"Score prompt", clarity:"Clart√©", constraints:"Contraintes", data:"Donn√©es" },
      footer: `Rappel : un bon prompt = <b>intention</b> + <b>contexte</b> + <b>inputs</b> + <b>contraintes</b> + <b>format</b> + <b>crit√®res</b>.`,
      badges: { before:"Flou / Non testable", after:"Contraint / Actionnable" },
      exportTxt: "Exporter .txt",
      exportJson: "Exporter .json",
      copyOk: "‚úÖ Copi√© !",
      copyDefault: "Copier le prompt final",
      formatOpts: {
        auto: "Auto (√† partir des contraintes)",
        bullets: "Bullet points",
        table: "Tableau",
        email: "Email",
        plan: "Plan d√©taill√©",
        code: "Code (avec instructions)",
        json: "JSON (sch√©ma simple)"
      },
      toneOpts: {
        neutre: "Neutre",
        pro: "Professionnel",
        direct: "Direct & concis",
        pedago: "P√©dagogique",
        creatif: "Cr√©atif",
        humble: "Empathique & humble"
      },
      placeholders: {
        goal: "Ex: R√©diger un email de relance professionnel‚Ä¶",
        role: "Ex: Agis comme un recruteur senior / un tuteur / un coach‚Ä¶",
        context: "Ex: Je postule √† un poste de‚Ä¶ J‚Äôai ce parcours‚Ä¶ Le but est de‚Ä¶",
        inputs: "Colle ici le texte √† retravailler, un brief, des points cl√©s, un tableau, etc.",
        constraints: "Ex: 180‚Äì220 mots, fran√ßais, pas de jargon, 3 options, pas de flatterie excessive‚Ä¶",
        success: "Ex: doit √™tre actionnable, clair, pas d‚Äôhypoth√®ses, inclure 3 √©tapes et un CTA‚Ä¶",
        audience: "Ex: un directeur RH, un client, des enfants de 6‚Äì10 ans‚Ä¶",
        examples: "Ex: j‚Äôaime des phrases courtes, un ton factuel; je n‚Äôaime pas les g√©n√©ralit√©s‚Ä¶"
      }
    },

    en: {
      docTitle: "Prompt Coach ‚Äî Best practices (ChatGPT)",
      hdrTagline: "Write clearer prompts. Get better results.",
      hdrSite: "LEOV website",
      mainTitle: "Prompt Coach ‚Äî Interactive app (ChatGPT prompting best practices)",
      mainSub: `Goal: help you go from a ‚Äúvague‚Äù prompt to a <b>clear</b>, <b>context-rich</b>, <b>constrained</b> and <b>testable</b> prompt.
               Fill the fields ‚Üí check the score ‚Üí apply improvements ‚Üí copy the final prompt.`,
      chips: [
        "‚úÖ Context & intent",
        "‚úÖ Constraints (format, tone, length)",
        "‚úÖ Data / examples",
        "‚úÖ Success criteria",
        "‚úÖ Iteration (missing questions)"
      ],
      btnLoadDemo: "Load an example",
      btnReset: "Reset",
      btnCopy: "Copy final prompt",
      builderTitle: "1) Prompt builder",
      diagTitle: "2) Diagnostics & final prompt",
      labels: {
        goal: "Goal (one sentence)",
        role: "Requested role / stance",
        context: "Context (who / what / why)",
        inputs: "Inputs (data, text, list, business constraints)",
        format: "Output format",
        tone: "Tone",
        constraints: "Constraints (length, language, do/don‚Äôt, style‚Ä¶)",
        success: "Success criteria (how to judge it‚Äôs good?)",
        audience: "Target audience",
        examples: "Example (optional): what I like / dislike",
        final: "Final prompt (copyable)",
        recos: "Actionable recommendations (prioritized)",
        anti: "Common anti-patterns",
        before: "‚ÄúBefore‚Äù prompt (too vague)",
        after: "‚ÄúAfter‚Äù prompt (improved)",
        templates: "Quick templates",
      },
      hints: {
        goal: "Tip: start with an action verb (write, analyze, compare, summarize, propose‚Ä¶).",
        role: "Tip: a useful role = expertise + angle (e.g., ‚Äúcareer coach for Qu√©bec market‚Äù).",
        inputs: "Tip: the more concrete inputs you provide, the less the model ‚Äúinvents‚Äù.",
        format: "Tip: ‚Äúgive me a table‚Äù ‚Üí specify columns/order/units.",
        success: "Tip: add ‚Äúif info is missing ‚Üí ask up to 3 questions first‚Äù.",
        templates: "Click a template ‚Üí it pre-fills the builder with a strong structure."
      },
      realtimeMsg: "üîÅ Everything updates in real time (score + recommendations).",
      btnAsk3: "Add ‚Äúask up to 3 questions if missing info‚Äù",
      btnAddSteps: "Add ‚Äúanswer in numbered steps‚Äù",
      tabs: { score:"Score", suggest:"Suggestions", examples:"Before / After" },
      kpi: { score:"Prompt score", clarity:"Clarity", constraints:"Constraints", data:"Data" },
      footer: `Reminder: a good prompt = <b>intent</b> + <b>context</b> + <b>inputs</b> + <b>constraints</b> + <b>format</b> + <b>criteria</b>.`,
      badges: { before:"Vague / Not testable", after:"Constrained / Actionable" },
      exportTxt: "Export .txt",
      exportJson: "Export .json",
      copyOk: "‚úÖ Copied!",
      copyDefault: "Copy final prompt",
      formatOpts: {
        auto: "Auto (from constraints)",
        bullets: "Bullet points",
        table: "Table",
        email: "Email",
        plan: "Detailed plan",
        code: "Code (with instructions)",
        json: "JSON (simple schema)"
      },
      toneOpts: {
        neutre: "Neutral",
        pro: "Professional",
        direct: "Direct & concise",
        pedago: "Educational",
        creatif: "Creative",
        humble: "Empathetic & humble"
      },
      placeholders: {
        goal: "e.g., Write a professional follow-up email‚Ä¶",
        role: "e.g., Act as a senior recruiter / tutor / coach‚Ä¶",
        context: "e.g., I‚Äôm applying for‚Ä¶ My background is‚Ä¶ The goal is‚Ä¶",
        inputs: "Paste the text to rewrite, a brief, key points, a table, etc.",
        constraints: "e.g., 180‚Äì220 words, English, no jargon, 3 options, no excessive flattery‚Ä¶",
        success: "e.g., must be actionable, clear, no assumptions, include 3 steps and a CTA‚Ä¶",
        audience: "e.g., HR Director, a client, kids aged 6‚Äì10‚Ä¶",
        examples: "e.g., I like short sentences, factual tone; I dislike generic advice‚Ä¶"
      }
    }
  };

  // ---------- State ----------
  const state = {
    demoIndex: 0,
    checklist: [
      { key:"goal", title:{fr:"Objectif explicite", en:"Clear goal"}, desc:{fr:"Le mod√®le sait exactement quoi produire.", en:"The model knows exactly what to produce."} },
      { key:"role", title:{fr:"R√¥le / posture", en:"Role / stance"}, desc:{fr:"Tu imposes une expertise et un angle (coach, tuteur, analyste‚Ä¶).", en:"You force an expertise and angle (coach, tutor, analyst‚Ä¶)."} },
      { key:"context", title:{fr:"Contexte suffisant", en:"Sufficient context"}, desc:{fr:"Qui/quoi/pourquoi + contraintes de situation.", en:"Who/what/why + situation constraints."} },
      { key:"inputs", title:{fr:"Inputs concrets", en:"Concrete inputs"}, desc:{fr:"Texte, donn√©es, exemples, √©l√©ments √† respecter.", en:"Text, data, examples, things to respect."} },
      { key:"constraints", title:{fr:"Contraintes", en:"Constraints"}, desc:{fr:"Longueur, langue, interdits, style, nombre d‚Äôoptions‚Ä¶", en:"Length, language, do/don‚Äôt, style, number of options‚Ä¶"} },
      { key:"format", title:{fr:"Format de sortie", en:"Output format"}, desc:{fr:"Tu r√©duis les ambigu√Øt√©s (tableau, √©tapes, email‚Ä¶).", en:"You reduce ambiguity (table, steps, email‚Ä¶)."} },
      { key:"success", title:{fr:"Crit√®res de succ√®s", en:"Success criteria"}, desc:{fr:"Comment juger la r√©ponse + ‚Äòpose questions si manque‚Äô.", en:"How to judge the answer + ‚Äòask questions if missing‚Äô."} }
    ]
  };

  const $id = (id) => document.getElementById(id);

  // ---------- Checklist UI ----------
  function buildChecklist(){
    const box = $id("checklist");
    box.innerHTML = "";
    state.checklist.forEach((c, idx) => {
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <input type="checkbox" id="chk_${c.key}" disabled />
        <div>
          <div class="t">${idx+1}. ${(lang==="fr") ? c.title.fr : c.title.en}</div>
          <div class="d">${(lang==="fr") ? c.desc.fr : c.desc.en}</div>
        </div>
      `;
      box.appendChild(div);
    });
  }

  // ---------- Scoring ----------
  function scorePrompt(d){
    const goal = sanitize(d.goal), role = sanitize(d.role), ctx = sanitize(d.context), inputs = sanitize(d.inputs);
    const constraints = sanitize(d.constraints), success = sanitize(d.success), audience = sanitize(d.audience);
    const examples = sanitize(d.examples);

    let clarity = 0, constr = 0, data = 0, test = 0;

    if (goal.length >= 12) clarity += 12;
    if (goal.length >= 35) clarity += 6;
    if (role.length >= 8) clarity += 5;
    if (audience.length >= 5) clarity += 2;

    if (constraints.length >= 10) constr += 10;
    if (constraints.match(/\b(mots|words|caract|chars|bullet|tableau|table|json|title|titre|sections?)\b/i)) constr += 6;
    if (constraints.match(/\b(ne pas|√©viter|interdit|sans|avoid|don'?t|do not|no)\b/i)) constr += 4;
    if (d.format && d.format !== "auto") constr += 5;

    if (ctx.length >= 25) data += 8;
    if (ctx.length >= 90) data += 5;
    if (inputs.length >= 20) data += 10;
    if (inputs.length >= 120) data += 5;
    if (examples.length >= 20) data += 2;

    if (success.length >= 15) test += 10;
    if (success.match(/\b(crit√®re|criteria|doit|must|should|succ√®s|success|validation|acceptable)\b/i)) test += 6;
    if ((success + " " + constraints).match(/\b(if|si|s'il)\b.*\b(missing|manque|incomplet|info)\b.*\b(question)\b/i)) test += 6;
    if ((success + " " + constraints).match(/\b(√©tapes|steps?|checklist|plan)\b/i)) test += 3;

    clarity = clamp(clarity,0,25);
    constr  = clamp(constr,0,25);
    data    = clamp(data,0,25);
    test    = clamp(test,0,25);

    const total = clarity + constr + data + test;
    const missing = {
      goal: goal.length < 12,
      role: role.length < 8,
      context: ctx.length < 25,
      inputs: inputs.length < 20,
      constraints: constraints.length < 10,
      format: !d.format || d.format === "auto",
      success: success.length < 15
    };

    return { total, clarity, constr, data, test, missing };
  }

  function scoreMessage(total){
    if (lang==="fr"){
      if (total >= 85) return { txt:"Excellent : prompt tr√®s contraint et actionnable. Tu peux it√©rer sur le style.", mood:"good" };
      if (total >= 70) return { txt:"Solide : il manque surtout des d√©tails (inputs/contraintes) pour √©viter les ambigu√Øt√©s.", mood:"warn" };
      if (total >= 50) return { txt:"Moyen : trop d‚Äôespace d‚Äôinterpr√©tation. Ajoute format + crit√®res + donn√©es concr√®tes.", mood:"warn" };
      return { txt:"Faible : prompt trop vague. Commence par objectif + contexte + format + contraintes.", mood:"bad" };
    }else{
      if (total >= 85) return { txt:"Excellent: very constrained and actionable. You can now refine style.", mood:"good" };
      if (total >= 70) return { txt:"Solid: mostly missing details (inputs/constraints) to avoid ambiguity.", mood:"warn" };
      if (total >= 50) return { txt:"Average: too much room for interpretation. Add format + criteria + concrete data.", mood:"warn" };
      return { txt:"Low: prompt is too vague. Start with goal + context + format + constraints.", mood:"bad" };
    }
  }

  // ---------- Prompt synthesis ----------
  function formatBlock(label, content){
    content = sanitize(content);
    if (!content) return "";
    return `## ${label}\n${content}\n\n`;
  }

  function formatHintFromSelect(format){
    if (lang==="fr"){
      switch(format){
        case "bullets": return "R√©ponds en bullet points.";
        case "table": return "R√©ponds sous forme de tableau (colonnes claires).";
        case "email": return "R√©dige un email complet (objet + corps + signature).";
        case "plan": return "Propose un plan d√©taill√© (niveaux 1/2/3).";
        case "code": return "Fournis du code complet, ex√©cutable, avec commentaires et √©tapes.";
        case "json": return "R√©ponds uniquement en JSON valide (sans texte autour).";
        default: return "";
      }
    }else{
      switch(format){
        case "bullets": return "Answer in bullet points.";
        case "table": return "Answer as a table (clear columns).";
        case "email": return "Write a complete email (subject + body + signature).";
        case "plan": return "Provide a detailed plan (levels 1/2/3).";
        case "code": return "Provide complete, runnable code with comments and steps.";
        case "json": return "Answer ONLY with valid JSON (no surrounding text).";
        default: return "";
      }
    }
  }

  function synthesizePrompt(d){
    const goal = sanitize(d.goal);
    const role = sanitize(d.role);
    const tone = sanitize(d.tone || (lang==="fr" ? "neutre" : "neutral"));
    const audience = sanitize(d.audience);
    const ctx = sanitize(d.context);
    const inputs = sanitize(d.inputs);
    const constraints = sanitize(d.constraints);
    const success = sanitize(d.success);
    const examples = sanitize(d.examples);
    const format = d.format || "auto";

    const fmtHint = (format !== "auto") ? formatHintFromSelect(format) : "";

    let header = "";
    if (role) header += (lang==="fr" ? `Tu es ${role}.\n` : `You are ${role}.\n`);
    if (tone) header += (lang==="fr" ? `Ton : ${tone}.\n` : `Tone: ${tone}.\n`);
    if (audience) header += (lang==="fr" ? `Audience cible : ${audience}.\n` : `Target audience: ${audience}.\n`);

    let core = "";
    if (goal) core += (lang==="fr" ? `# T√¢che\n${goal}\n\n` : `# Task\n${goal}\n\n`);

    core += formatBlock(lang==="fr" ? "Contexte" : "Context", ctx);
    core += formatBlock(lang==="fr" ? "Entr√©es" : "Inputs", inputs);
    core += formatBlock(lang==="fr" ? "Contraintes" : "Constraints", constraints || "");
    if (fmtHint) core += `## ${lang==="fr" ? "Format de sortie" : "Output format"}\n${fmtHint}\n\n`;
    core += formatBlock(lang==="fr" ? "Crit√®res de succ√®s" : "Success criteria", success);
    core += formatBlock(lang==="fr" ? "Pr√©f√©rences / exemples" : "Preferences / examples", examples);

    // ================================
// FINAL INSTRUCTIONS (LEOV STANDARD)
// ================================
const finalInstructionsFR = `
## INSTRUCTIONS FINALES IMPORTANTES
- Suis strictement toutes les instructions et contraintes ci-dessus.
- Si une information critique est manquante, pose jusqu‚Äô√† 3 questions AVANT de r√©pondre.
- N‚Äôinvente aucun fait.
- Si tu fais une hypoth√®se, explicite-la clairement.
- Privil√©gie une r√©ponse claire, structur√©e et directement actionnable.
`;

const finalInstructionsEN = `
## FINAL INSTRUCTIONS
- Strictly follow all instructions and constraints above.
- If critical information is missing, ask up to 3 questions BEFORE answering.
- Do not invent facts.
- If you make assumptions, clearly state them.
- Favor clarity, structure, and actionable output.
`;
    
const instructionsFinales =
  document.documentElement.lang === "fr"
    ? finalInstructionsFR
    : finalInstructionsEN;

const final = `${header}\n${core}\n${instructionsFinales}`.trim();
;
  }

  // ---------- Suggestions ----------
  function buildSuggestions(d, scored){
    const s = [];
    const fr = (lang==="fr");

    if (scored.missing.goal) s.push({p:1, t: fr?"Clarifie l‚Äôobjectif":"Clarify the goal", d: fr?"R√©√©cris l‚Äôobjectif en 1 phrase action : verbe + livrable + sujet.":"Rewrite the goal in 1 action sentence: verb + deliverable + topic."});
    if (scored.missing.context) s.push({p:2, t: fr?"Ajoute un contexte minimal":"Add minimal context", d: fr?"Qui ? Dans quel cadre ? Pourquoi maintenant ? 2‚Äì5 lignes suffisent.":"Who? In what context? Why now? 2‚Äì5 lines are enough."});
    if (scored.missing.inputs) s.push({p:3, t: fr?"Fournis des inputs concrets":"Provide concrete inputs", d: fr?"Colle le texte/donn√©es √† transformer, ou liste les faits √† respecter.":"Paste the text/data to transform, or list facts to respect."});
    if (scored.missing.constraints) s.push({p:4, t: fr?"Sp√©cifie des contraintes":"Specify constraints", d: fr?"Longueur, langue, style, interdits, nombre d‚Äôoptions, niveau de d√©tail.":"Length, language, style, do/don‚Äôt, number of options, detail level."});
    if (scored.missing.format) s.push({p:5, t: fr?"Force un format de sortie":"Force an output format", d: fr?"Choisis un format (tableau, √©tapes, email, JSON‚Ä¶) et pr√©cise la structure.":"Pick a format (table, steps, email, JSON‚Ä¶) and specify structure."});
    if (scored.missing.success) s.push({p:6, t: fr?"Ajoute des crit√®res de succ√®s":"Add success criteria", d: fr?"√âcris 3‚Äì5 crit√®res mesurables (doit inclure‚Ä¶, √©viter‚Ä¶, ton‚Ä¶, CTA‚Ä¶).":"Write 3‚Äì5 measurable criteria (must include‚Ä¶, avoid‚Ä¶, tone‚Ä¶, CTA‚Ä¶)."});
    if (!sanitize(d.role)) s.push({p:7, t: fr?"D√©finis un r√¥le utile":"Define a useful role", d: fr?"‚ÄúAgis comme ‚Ä¶‚Äù (expertise + angle).":"‚ÄúAct as ‚Ä¶‚Äù (expertise + angle)."});

    const merged = (sanitize(d.goal) + " " + sanitize(d.context) + " " + sanitize(d.constraints) + " " + sanitize(d.success)).toLowerCase();
    if (merged.includes(fr?"fait moi":"do this") && merged.length < 80) s.push({p:8, t: fr?"Trop court = trop flou":"Too short = too vague", d: fr?"Ajoute contexte + contraintes pour r√©duire l‚Äôambigu√Øt√©.":"Add context + constraints to reduce ambiguity."});
    if (merged.match(/\bcomme tu veux|au choix|peu importe|whatever|any way|as you like\b/)) s.push({p:9, t: fr?"√âvite ‚Äúau choix / peu importe‚Äù":"Avoid ‚Äúwhatever / as you like‚Äù", d: fr?"Remplace par des pr√©f√©rences ou des crit√®res.":"Replace with preferences or criteria."});

    s.sort((a,b)=>a.p-b.p);
    return s;
  }

  function renderSuggestions(list){
    const box = $id("suggestions");
    if (!list.length){
      box.innerHTML = `<div class="out">‚úÖ ${(lang==="fr") ? "Rien de critique √† corriger. Tu peux optimiser le style." : "Nothing critical to fix. You can now refine style."}</div>`;
      return;
    }
    box.innerHTML = list.map(x => `
      <div class="item" style="margin-bottom:10px">
        <div class="badge">P${x.p}</div>
        <div>
          <div class="t">${x.t}</div>
          <div class="d">${x.d}</div>
        </div>
      </div>
    `).join("");
  }

  // ---------- Demos / Templates (FR + EN) ----------
  const demos_fr = [
    {
      name:"Email relance",
      goal:"R√©dige un email de relance pour obtenir une r√©ponse √† une candidature envoy√©e il y a 10 jours.",
      role:"un recruteur senior (ton professionnel, respectueux, orient√© action)",
      context:"J‚Äôai postul√© √† un poste de Directeur Transformation. Je veux relancer sans insister, tout en rappelant ma valeur.",
      inputs:"Nom du recruteur : Sophie Martin\nEntreprise : ExempleCorp\nPoste : Directeur Transformation\nDate d‚Äôenvoi candidature : il y a 10 jours\nPoint fort √† rappeler : 10+ ans de programmes de transformation, leadership, delivery.",
      constraints:"En fran√ßais. 140‚Äì170 mots. 1 objet d‚Äôemail. Pas de flatterie excessive. Inclure une proposition de cr√©neau de 15 min.",
      success:"Doit √™tre clair, poli, et donner envie de r√©pondre. Inclure 1 phrase de rappel de valeur et 1 CTA concret.",
      audience:"Recruteur / Talent Acquisition",
      examples:"J‚Äôaime un style simple, phrases courtes, pas de jargon.",
      format:"email",
      tone:"pro"
    },
    {
      name:"Analyse de texte",
      goal:"Analyse ce texte et identifie 5 am√©liorations concr√®tes (structure, clart√©, arguments).",
      role:"un tuteur d‚Äô√©criture acad√©mique",
      context:"Je pr√©pare un devoir et j‚Äôai besoin d‚Äôun diagnostic actionnable.",
      inputs:"[COLLE ICI TON TEXTE]\n\n(ou un extrait de 2‚Äì3 paragraphes)",
      constraints:"En fran√ßais. R√©ponse en 2 parties : (1) diagnostic (2) recommandations. Chaque recommandation doit inclure un exemple de reformulation.",
      success:"Doit √™tre pr√©cis, non vague, et applicable imm√©diatement.",
      audience:"√âtudiant / professeur",
      examples:"",
      format:"bullets",
      tone:"pedago"
    }
  ];

  const demos_en = [
    {
      name:"Follow-up email",
      goal:"Write a follow-up email to get a response to a job application sent 10 days ago.",
      role:"a senior recruiter (professional, respectful, action-oriented)",
      context:"I applied for a Director of Transformation role. I want to follow up without pushing, while reminding my value.",
      inputs:"Recruiter name: Sophie Martin\nCompany: ExampleCorp\nRole: Director of Transformation\nApplication date: 10 days ago\nStrength to highlight: 10+ years leading transformation programs, leadership, delivery.",
      constraints:"In English. 140‚Äì170 words. 1 email subject line. No excessive flattery. Include a proposal for a 15-min slot.",
      success:"Must be clear, polite, and encourage a reply. Include 1 value reminder sentence and 1 concrete CTA.",
      audience:"Recruiter / Talent Acquisition",
      examples:"I like simple style, short sentences, no jargon.",
      format:"email",
      tone:"pro"
    },
    {
      name:"Text analysis",
      goal:"Analyze this text and identify 5 concrete improvements (structure, clarity, arguments).",
      role:"an academic writing tutor",
      context:"I‚Äôm preparing an assignment and need an actionable diagnosis.",
      inputs:"[PASTE YOUR TEXT HERE]\n\n(or 2‚Äì3 paragraphs excerpt)",
      constraints:"In English. Answer in 2 parts: (1) diagnosis (2) recommendations. Each recommendation must include a rewrite example.",
      success:"Must be specific, not vague, and immediately applicable.",
      audience:"Student / professor",
      examples:"",
      format:"bullets",
      tone:"pedago"
    }
  ];

  const templates_fr = {
    rewrite: {
      goal:"R√©√©cris le texte ci-dessous pour qu‚Äôil soit plus clair et plus convaincant.",
      role:"un √©diteur professionnel",
      context:"Je veux conserver le sens, am√©liorer la structure et la fluidit√©.",
      inputs:"TEXTE √Ä R√â√âCRIRE :\n[COLLE ICI]",
      constraints:"En fran√ßais. Conserver les faits. R√©duire de 15‚Äì25%. Phrases plus courtes. Pas de jargon.",
      success:"Texte plus lisible, m√™me message, meilleur rythme. Propose aussi 3 alternatives de titre.",
      audience:"Grand public",
      examples:"J‚Äôaime un style simple et direct.",
      format:"auto",
      tone:"pro"
    },
    analysis: {
      goal:"Analyse la situation et propose 3 options avec avantages/inconv√©nients et une recommandation finale.",
      role:"un consultant strat√©gique",
      context:"Je dois prendre une d√©cision et je veux un raisonnement structur√©.",
      inputs:"CONTEXTE & DONN√âES :\n[COLLE ICI]",
      constraints:"R√©ponds en tableau pour les options, puis une recommandation en 5‚Äì7 lignes. N‚Äôinvente pas de donn√©es.",
      success:"Options distinctes, crit√®res explicites, recommandation argument√©e.",
      audience:"D√©cideur",
      examples:"",
      format:"table",
      tone:"pro"
    },
    plan: {
      goal:"Construis un plan d√©taill√© pour atteindre l‚Äôobjectif ci-dessous.",
      role:"un coach op√©rationnel",
      context:"Je veux un plan r√©aliste, s√©quenc√©, avec livrables et jalons.",
      inputs:"OBJECTIF :\n[COLLE ICI]\n\nCONTRAINTES :\n[COLLE ICI]",
      constraints:"Plan en 4 phases max. Pour chaque phase : objectifs, actions, livrables, risques. Ton concis.",
      success:"Plan actionnable, sans zones floues, avec d√©pendances et priorit√©s.",
      audience:"√âquipe projet",
      examples:"",
      format:"plan",
      tone:"direct"
    },
    code: {
      goal:"√âcris le code complet pour r√©aliser la fonctionnalit√© d√©crite ci-dessous.",
      role:"un d√©veloppeur senior",
      context:"Je veux une solution simple, lisible et ex√©cutable.",
      inputs:"SPECS :\n[COLLE ICI]\n\nSTACK :\nHTML/CSS/JS (vanilla) ou autre",
      constraints:"Fournis 1 fichier complet. Ajoute des commentaires. Explique comment ex√©cuter. Pas de d√©pendances inutiles.",
      success:"Code ex√©cutable, structur√©, sans erreurs, UX minimale.",
      audience:"D√©veloppeur",
      examples:"",
      format:"code",
      tone:"neutre"
    },
    brainstorm: {
      goal:"G√©n√®re 20 id√©es cr√©atives r√©pondant au besoin ci-dessous, puis s√©lectionne les 5 meilleures.",
      role:"un facilitateur de cr√©ativit√©",
      context:"Je veux des id√©es vari√©es et non √©videntes.",
      inputs:"BESOIN :\n[COLLE ICI]",
      constraints:"R√©ponds en 2 parties : (1) 20 id√©es courtes (2) top 5 avec justification en 2 lignes chacune.",
      success:"Id√©es originales, diversit√©, top 5 justifi√©.",
      audience:"√âquipe produit",
      examples:"",
      format:"bullets",
      tone:"creatif"
    }
  };

  const templates_en = {
    rewrite: {
      goal:"Rewrite the text below to make it clearer and more convincing.",
      role:"a professional editor",
      context:"Keep the meaning, improve structure and flow.",
      inputs:"TEXT TO REWRITE:\n[PASTE HERE]",
      constraints:"In English. Keep facts. Reduce by 15‚Äì25%. Shorter sentences. No jargon.",
      success:"More readable text, same message, better rhythm. Also propose 3 title alternatives.",
      audience:"General audience",
      examples:"I like a simple and direct style.",
      format:"auto",
      tone:"pro"
    },
    analysis: {
      goal:"Analyze the situation and propose 3 options with pros/cons and a final recommendation.",
      role:"a strategy consultant",
      context:"I need to make a decision and want structured reasoning.",
      inputs:"CONTEXT & DATA:\n[PASTE HERE]",
      constraints:"Use a table for options, then a 5‚Äì7 line recommendation. Do not invent data.",
      success:"Distinct options, explicit criteria, well-argued recommendation.",
      audience:"Decision-maker",
      examples:"",
      format:"table",
      tone:"pro"
    },
    plan: {
      goal:"Build a detailed plan to achieve the goal below.",
      role:"an execution coach",
      context:"I want a realistic, sequenced plan with deliverables and milestones.",
      inputs:"GOAL:\n[PASTE HERE]\n\nCONSTRAINTS:\n[PASTE HERE]",
      constraints:"Max 4 phases. For each phase: goals, actions, deliverables, risks. Concise tone.",
      success:"Actionable plan, no vague areas, with dependencies and priorities.",
      audience:"Project team",
      examples:"",
      format:"plan",
      tone:"direct"
    },
    code: {
      goal:"Write complete code to implement the feature described below.",
      role:"a senior developer",
      context:"I want a simple, readable and runnable solution.",
      inputs:"SPECS:\n[PASTE HERE]\n\nSTACK:\nHTML/CSS/JS (vanilla) or other",
      constraints:"Provide 1 complete file. Add comments. Explain how to run. No useless dependencies.",
      success:"Runnable code, structured, no errors, minimal UX.",
      audience:"Developer",
      examples:"",
      format:"code",
      tone:"neutre"
    },
    brainstorm: {
      goal:"Generate 20 creative ideas for the need below, then pick the best 5.",
      role:"a creativity facilitator",
      context:"I want diverse, non-obvious ideas.",
      inputs:"NEED:\n[PASTE HERE]",
      constraints:"2 parts: (1) 20 short ideas (2) top 5 with 2-line justification each.",
      success:"Original ideas, diversity, top 5 justified.",
      audience:"Product team",
      examples:"",
      format:"bullets",
      tone:"creatif"
    }
  };

  // ---------- UI Bindings ----------
  const fields = ["goal","role","context","inputs","constraints","success","audience","examples","format","tone"];
  function bindFields(){
    fields.forEach(id=>{
      const el = $id(id);
      el.addEventListener("input", updateAll);
      el.addEventListener("change", updateAll);
    });
  }

  document.querySelectorAll(".tab").forEach(t=>{
    t.addEventListener("click", () => {
      document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
      t.classList.add("active");
      const tab = t.getAttribute("data-tab");
      $id("tab-score").style.display   = tab==="score" ? "" : "none";
      $id("tab-suggest").style.display = tab==="suggest" ? "" : "none";
      $id("tab-examples").style.display= tab==="examples" ? "" : "none";
    });
  });

  // ---------- Export ----------
  function downloadFile(filename, content, mime){
    const blob = new Blob([content], {type:mime});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = filename; a.click();
    setTimeout(()=>URL.revokeObjectURL(url), 2000);
  }

  function gatherData(){
    return {
      goal: $id("goal").value,
      role: $id("role").value,
      context: $id("context").value,
      inputs: $id("inputs").value,
      constraints: $id("constraints").value,
      success: $id("success").value,
      audience: $id("audience").value,
      examples: $id("examples").value,
      format: $id("format").value,
      tone: $id("tone").value
    };
  }

  function applyData(d){
    $id("goal").value = d.goal || "";
    $id("role").value = d.role || "";
    $id("context").value = d.context || "";
    $id("inputs").value = d.inputs || "";
    $id("constraints").value = d.constraints || "";
    $id("success").value = d.success || "";
    $id("audience").value = d.audience || "";
    $id("examples").value = d.examples || "";
    $id("format").value = d.format || "auto";
    $id("tone").value = d.tone || "neutre";
    updateAll();
  }

  // ---------- Anti-patterns text ----------
  function getAntiPatterns(){
    if (lang==="fr"){
      return `‚Ä¢ ‚ÄúFais-moi un truc bien‚Äù ‚Üí pas d‚Äôobjectif, pas de format, pas de crit√®res
‚Ä¢ ‚ÄúTu vois ce que je veux dire‚Äù ‚Üí le mod√®le ne lit pas tes intentions implicites
‚Ä¢ ‚ÄúComme tu veux‚Äù / ‚Äúau choix‚Äù ‚Üí ouvre trop l‚Äôespace de r√©ponse
‚Ä¢ Aucun input (texte / donn√©es) ‚Üí risque d‚Äôhallucination ou de g√©n√©ralit√©s
‚Ä¢ Trop de demandes sans priorit√©s ‚Üí m√©lange, r√©ponse superficielle
‚Ä¢ Format non impos√© ‚Üí structure al√©atoire, difficile √† r√©utiliser
‚Ä¢ Crit√®res absents ‚Üí impossible de juger si c‚Äôest ‚Äúbon‚Äù`;
    }
    return `‚Ä¢ ‚ÄúDo something nice‚Äù ‚Üí no goal, no format, no criteria
‚Ä¢ ‚ÄúYou know what I mean‚Äù ‚Üí the model can‚Äôt read implicit intent
‚Ä¢ ‚ÄúWhatever / as you like‚Äù ‚Üí opens too much space
‚Ä¢ No inputs (text/data) ‚Üí risk of generic output
‚Ä¢ Too many requests without priorities ‚Üí shallow answer
‚Ä¢ No forced format ‚Üí messy structure
‚Ä¢ No criteria ‚Üí impossible to judge if it‚Äôs ‚Äúgood‚Äù`;
  }

  // ---------- Before / After examples ----------
  function buildBeforeAfter(d){
    const before = (lang==="fr")
      ? `Peux-tu m'aider ? Fais un texte sympa.`
      : `Can you help me? Write something nice.`;

    const after = synthesizePrompt({
      goal: d.goal || (lang==="fr" ? "R√©dige un livrable utile sur le sujet ci-dessous." : "Write a useful deliverable on the topic below."),
      role: d.role || (lang==="fr" ? "un assistant expert" : "an expert assistant"),
      context: d.context || (lang==="fr" ? "Contexte : ‚Ä¶" : "Context: ‚Ä¶"),
      inputs: d.inputs || (lang==="fr" ? "Entr√©es : ‚Ä¶" : "Inputs: ‚Ä¶"),
      constraints: d.constraints || (lang==="fr" ? "Contraintes : ‚Ä¶" : "Constraints: ‚Ä¶"),
      success: d.success || (lang==="fr" ? "Crit√®res : ‚Ä¶" : "Criteria: ‚Ä¶"),
      audience: d.audience || "",
      examples: d.examples || "",
      format: d.format || "auto",
      tone: d.tone || (lang==="fr" ? "pro" : "pro")
    });

    $id("beforeEx").innerText = before;
    $id("afterEx").innerText = after;
  }

  // ---------- Update Loop ----------
  function updateAll(){
    const d = gatherData();
    $id("modePill").innerText = (lang==="fr")
      ? `Mode : ${d.format === "auto" ? "G√©n√©ral" : d.format.toUpperCase()}`
      : `Mode: ${d.format === "auto" ? "General" : d.format.toUpperCase()}`;

    const scored = scorePrompt(d);
    $id("scoreVal").innerText = `${scored.total}/100`;
    $id("kpiClarity").innerText = scored.clarity;
    $id("kpiConstraints").innerText = scored.constr;
    $id("kpiData").innerText = scored.data;

    $id("scoreBar").style.width = `${scored.total}%`;
    const msg = scoreMessage(scored.total);
    $id("scoreMsg").innerText = msg.txt;

    state.checklist.forEach(c=>{
      const chk = $id("chk_" + c.key);
      if (!chk) return;
      chk.checked = !scored.missing[c.key];
    });

    $id("finalPrompt").innerText = synthesizePrompt(d);

    const sug = buildSuggestions(d, scored);
    renderSuggestions(sug);

    $id("antipatterns").innerText = getAntiPatterns();
    buildBeforeAfter(d);
  }

  // ---------- Buttons ----------
  $id("btnAsk3").addEventListener("click", () => {
    const v = sanitize($id("success").value);
    const needle = (lang==="fr") ? "pose" : "ask";
    if (!v.toLowerCase().includes(needle)) {
      $id("success").value = (v ? v + "\n" : "") + (lang==="fr"
        ? "Si des informations manquent, pose jusqu‚Äô√† 3 questions courtes avant de r√©pondre."
        : "If information is missing, ask up to 3 short questions before answering.");
      updateAll();
    }
  });

  $id("btnAddSteps").addEventListener("click", () => {
    const v = sanitize($id("constraints").value);
    const needle = (lang==="fr") ? "√©tapes" : "steps";
    if (!v.toLowerCase().includes(needle)) {
      $id("constraints").value = (v ? v + "\n" : "") + (lang==="fr"
        ? "R√©ponds en √©tapes num√©rot√©es."
        : "Answer in numbered steps.");
      updateAll();
    }
  });

  $id("btnCopy").addEventListener("click", async () => {
    const text = $id("finalPrompt").innerText;
    try{
      await navigator.clipboard.writeText(text);
      $id("btnCopy").innerText = I18N[lang].copyOk;
      setTimeout(()=> $id("btnCopy").innerText = I18N[lang].copyDefault, 1100);
    }catch(e){
      alert(lang==="fr"
        ? "Impossible de copier automatiquement. S√©lectionne le texte et copie manuellement."
        : "Unable to copy automatically. Select the text and copy manually.");
    }
  });

  $id("btnReset").addEventListener("click", () => {
    fields.forEach(id=>{
      if (id==="format") $id(id).value = "auto";
      else if (id==="tone") $id(id).value = "neutre";
      else $id(id).value = "";
    });
    state.demoIndex = 0;
    updateAll();
  });

  $id("btnLoadDemo").addEventListener("click", () => {
    const demos = (lang==="fr") ? demos_fr : demos_en;
    const d = demos[state.demoIndex % demos.length];
    state.demoIndex++;
    applyData(d);
  });

  document.querySelectorAll("[data-template]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const key = btn.getAttribute("data-template");
      const templates = (lang==="fr") ? templates_fr : templates_en;
      applyData(templates[key]);
      document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
      document.querySelector('.tab[data-tab="score"]').classList.add("active");
      $id("tab-score").style.display = "";
      $id("tab-suggest").style.display = "none";
      $id("tab-examples").style.display = "none";
    });
  });

  $id("btnExportTxt").addEventListener("click", () => {
    downloadFile("prompt.txt", $id("finalPrompt").innerText, "text/plain;charset=utf-8");
  });

  $id("btnExportJson").addEventListener("click", () => {
    const d = gatherData();
    const payload = { meta:{ exported_at: nowISO(), app:"Prompt Coach" }, input:d, final_prompt: $id("finalPrompt").innerText, lang };
    downloadFile("prompt.json", JSON.stringify(payload,null,2), "application/json;charset=utf-8");
  });

  // ---------- Language apply ----------
  function applyLang(newLang){
    lang = newLang;
    document.documentElement.lang = lang;

    const t = I18N[lang];
    document.title = t.docTitle;

    $id("hdr_tagline").innerText = t.hdrTagline;
    $id("hdr_site").innerText = t.hdrSite;

    $id("mainTitle").innerText = t.mainTitle;
    $id("mainSub").innerHTML = t.mainSub;

    $id("chip1").innerHTML = t.chips[0];
    $id("chip2").innerHTML = t.chips[1];
    $id("chip3").innerHTML = t.chips[2];
    $id("chip4").innerHTML = t.chips[3];
    $id("chip5").innerHTML = t.chips[4];

    $id("btnLoadDemo").innerText = t.btnLoadDemo;
    $id("btnReset").innerText = t.btnReset;
    $id("btnCopy").innerText = t.copyDefault;

    $id("h2_builder").innerText = t.builderTitle;
    $id("h2_diag").innerText = t.diagTitle;

    $id("lbl_goal").innerText = t.labels.goal;
    $id("lbl_role").innerText = t.labels.role;
    $id("lbl_context").innerText = t.labels.context;
    $id("lbl_inputs").innerText = t.labels.inputs;
    $id("lbl_format").innerText = t.labels.format;
    $id("lbl_tone").innerText = t.labels.tone;
    $id("lbl_constraints").innerText = t.labels.constraints;
    $id("lbl_success").innerText = t.labels.success;
    $id("lbl_audience").innerText = t.labels.audience;
    $id("lbl_examples").innerText = t.labels.examples;

    $id("hint_goal").innerText = t.hints.goal;
    $id("hint_role").innerText = t.hints.role;
    $id("hint_inputs").innerText = t.hints.inputs;
    $id("hint_format").innerText = t.hints.format;
    $id("hint_success").innerText = t.hints.success;

    $id("goal").placeholder = t.placeholders.goal;
    $id("role").placeholder = t.placeholders.role;
    $id("context").placeholder = t.placeholders.context;
    $id("inputs").placeholder = t.placeholders.inputs;
    $id("constraints").placeholder = t.placeholders.constraints;
    $id("success").placeholder = t.placeholders.success;
    $id("audience").placeholder = t.placeholders.audience;
    $id("examples").placeholder = t.placeholders.examples;

    $id("opt_auto").innerText = t.formatOpts.auto;
    $id("opt_bullets").innerText = t.formatOpts.bullets;
    $id("opt_table").innerText = t.formatOpts.table;
    $id("opt_email").innerText = t.formatOpts.email;
    $id("opt_plan").innerText = t.formatOpts.plan;
    $id("opt_code").innerText = t.formatOpts.code;
    $id("opt_json").innerText = t.formatOpts.json;

    $id("tone_neutre").innerText = t.toneOpts.neutre;
    $id("tone_pro").innerText = t.toneOpts.pro;
    $id("tone_direct").innerText = t.toneOpts.direct;
    $id("tone_pedago").innerText = t.toneOpts.pedago;
    $id("tone_creatif").innerText = t.toneOpts.creatif;
    $id("tone_humble").innerText = t.toneOpts.humble;

    $id("realtimeMsg").innerText = t.realtimeMsg;
    $id("btnAsk3").innerText = t.btnAsk3;
    $id("btnAddSteps").innerText = t.btnAddSteps;

    $id("tabScore").innerText = t.tabs.score;
    $id("tabSuggest").innerText = t.tabs.suggest;
    $id("tabExamples").innerText = t.tabs.examples;

    $id("labScore").innerText = t.kpi.score;
    $id("labClarity").innerText = t.kpi.clarity;
    $id("labConstraints").innerText = t.kpi.constraints;
    $id("labData").innerText = t.kpi.data;

    $id("lbl_final").innerText = t.labels.final;
    $id("btnExportTxt").innerText = t.exportTxt;
    $id("btnExportJson").innerText = t.exportJson;
    $id("footerMsg").innerHTML = t.footer;

    $id("lbl_recos").innerText = t.labels.recos;
    $id("lbl_anti").innerText = t.labels.anti;

    $id("lbl_before").innerText = t.labels.before;
    $id("lbl_after").innerText = t.labels.after;
    $id("badge_before").innerText = t.badges.before;
    $id("badge_after").innerText = t.badges.after;

    $id("lbl_templates").innerText = t.labels.templates;
    $id("tpl_rewrite").innerText = (lang==="fr") ? "R√©√©criture" : "Rewrite";
    $id("tpl_analysis").innerText = (lang==="fr") ? "Analyse" : "Analysis";
    $id("tpl_plan").innerText = (lang==="fr") ? "Plan" : "Plan";
    $id("tpl_code").innerText = (lang==="fr") ? "Code" : "Code";
    $id("tpl_brainstorm").innerText = "Brainstorm";

    $id("tpl_hint").innerText = t.hints.templates;

    buildChecklist();
    updateAll();
  }

  // ---------- Lang switch ----------
  $id("btnLang").addEventListener("click", () => {
    applyLang(lang==="fr" ? "en" : "fr");
  });

  // ---------- Init ----------
  bindFields();
  applyLang("fr"); // default
})();
</script>

</body>
</html>
